# åˆ†å¸ƒå¼æ¸¸æˆæ’è¡Œæ¦œç³»ç»Ÿ

ä¸€ä¸ªé«˜æ€§èƒ½ã€é«˜å¹¶å‘çš„åˆ†å¸ƒå¼æ¸¸æˆæ’è¡Œæ¦œå¾®æœåŠ¡ç³»ç»Ÿï¼Œæ”¯æŒåŠ¨æ€ä¼¸ç¼©å’Œå¤šèŠ‚ç‚¹éƒ¨ç½²ï¼Œç¡®ä¿æ•°æ®ä¸€è‡´æ€§ã€‚

## ğŸš€ ç‰¹æ€§

- **é«˜æ€§èƒ½**: åŸºäºGoè¯­è¨€å¼€å‘ï¼Œæ”¯æŒé«˜å¹¶å‘å¤„ç†
- **åˆ†å¸ƒå¼**: æ”¯æŒå¤šèŠ‚ç‚¹éƒ¨ç½²å’ŒåŠ¨æ€ä¼¸ç¼©
- **æ•°æ®ä¸€è‡´æ€§**: ä½¿ç”¨MongoDB + Redisç¡®ä¿æ•°æ®ä¸€è‡´æ€§
- **å®æ—¶æ’å**: Redisç¼“å­˜æä¾›æ¯«ç§’çº§æ’åæŸ¥è¯¢
- **å¤šç§æ’è¡Œæ¦œ**: æ”¯æŒå…¨å±€ã€æ—¥æ¦œã€å‘¨æ¦œã€æœˆæ¦œç­‰å¤šç§ç±»å‹
- **RESTful API**: æä¾›å®Œæ•´çš„REST APIæ¥å£
- **ç›‘æ§å‘Šè­¦**: é›†æˆPrometheus + Grafanaç›‘æ§
- **å®¹å™¨åŒ–**: æ”¯æŒDockerå®¹å™¨åŒ–éƒ¨ç½²
- **å¥åº·æ£€æŸ¥**: å®Œå–„çš„å¥åº·æ£€æŸ¥å’Œæ•…éšœè½¬ç§»æœºåˆ¶

## ğŸ—ï¸ ç³»ç»Ÿæ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   æ¸¸æˆå®¢æˆ·ç«¯    â”‚    â”‚   æ¸¸æˆæœåŠ¡å™¨    â”‚    â”‚   ç®¡ç†åå°      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚                       â”‚                       â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                 â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚   è´Ÿè½½å‡è¡¡å™¨    â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                 â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚                       â”‚                       â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ æ’è¡Œæ¦œæœåŠ¡èŠ‚ç‚¹1  â”‚    â”‚ æ’è¡Œæ¦œæœåŠ¡èŠ‚ç‚¹2  â”‚    â”‚ æ’è¡Œæ¦œæœåŠ¡èŠ‚ç‚¹N  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚                       â”‚                       â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚   Redisé›†ç¾¤     â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚  MongoDBé›†ç¾¤    â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ› ï¸ æŠ€æœ¯æ ˆ

- **åç«¯**: Go 1.21 + Gin + netcore-go
- **æ•°æ®åº“**: MongoDB 7.0 (æŒä¹…åŒ–å­˜å‚¨)
- **ç¼“å­˜**: Redis 7.2 (å®æ—¶æ’åç¼“å­˜)
- **æ—¥å¿—**: spooræ—¥å¿—åº“
- **ç›‘æ§**: Prometheus + Grafana
- **å®¹å™¨åŒ–**: Docker + Docker Compose
- **è´Ÿè½½å‡è¡¡**: Nginx (å¯é€‰)
- **æœåŠ¡å‘ç°**: Consul (å¯é€‰)

## ğŸ“¦ å¿«é€Ÿå¼€å§‹

### ç¯å¢ƒè¦æ±‚

- Go 1.21+
- Docker & Docker Compose
- MongoDB 7.0+
- Redis 7.2+

### 1. å…‹éš†é¡¹ç›®

```bash
git clone <repository-url>
cd ranking
```

### 2. ä½¿ç”¨Docker Composeå¯åŠ¨

```bash
# å¯åŠ¨å®Œæ•´ç¯å¢ƒ
make dev-full

# æˆ–è€…æ‰‹åŠ¨å¯åŠ¨
docker-compose --profile tools --profile monitoring up -d
```

### 3. éªŒè¯æœåŠ¡

```bash
# å¥åº·æ£€æŸ¥
curl http://localhost:8080/health

# è·å–æ’è¡Œæ¦œåˆ—è¡¨
curl http://localhost:8080/api/v1/leaderboard/list
```

### 4. è®¿é—®ç®¡ç†ç•Œé¢

- **åº”ç”¨æœåŠ¡**: http://localhost:8080
- **MongoDBç®¡ç†**: http://localhost:8081 (admin/admin)
- **Redisç®¡ç†**: http://localhost:8082 (admin/admin)
- **Prometheus**: http://localhost:9091
- **Grafana**: http://localhost:3000 (admin/admin)

## ğŸ”§ æœ¬åœ°å¼€å‘

### 1. å®‰è£…ä¾èµ–

```bash
make deps
```

### 2. å¯åŠ¨å¼€å‘ç¯å¢ƒ

```bash
# å¯åŠ¨æ•°æ®åº“æœåŠ¡
make dev

# è¿è¡Œåº”ç”¨
make run
```

### 3. ä»£ç æ£€æŸ¥

```bash
# æ ¼å¼åŒ–ä»£ç 
make fmt

# è¿è¡Œæ‰€æœ‰æ£€æŸ¥
make check
```

### 4. è¿è¡Œæµ‹è¯•

```bash
make test
```

## ğŸ“š API æ–‡æ¡£

### æ’è¡Œæ¦œç®¡ç†

#### åˆ›å»ºæ’è¡Œæ¦œ

```http
POST /api/v1/leaderboard/create
Content-Type: application/json

{
  "name": "å…¨çƒç§¯åˆ†æ’è¡Œæ¦œ",
  "game_id": "my_game",
  "type": "global",
  "sort_order": "desc",
  "max_entries": 10000,
  "config": {
    "timezone": "UTC"
  }
}
```

#### è·å–æ’è¡Œæ¦œ

```http
GET /api/v1/leaderboard/{id}?limit=100&offset=0
```

#### è·å–ç”¨æˆ·æ’å

```http
GET /api/v1/leaderboard/{id}/rank/{userId}
```

### åˆ†æ•°ç®¡ç†

#### æäº¤åˆ†æ•°

```http
POST /api/v1/score/submit
Content-Type: application/json

{
  "leaderboard_id": "global_score_demo",
  "user_id": "user_123",
  "score": 95000,
  "source": "game",
  "metadata": {
    "level": 10,
    "achievement": "high_score"
  }
}
```

#### æ‰¹é‡æäº¤åˆ†æ•°

```http
POST /api/v1/score/batch
Content-Type: application/json

{
  "leaderboard_id": "global_score_demo",
  "scores": [
    {
      "user_id": "user_123",
      "score": 95000
    },
    {
      "user_id": "user_456",
      "score": 87500
    }
  ]
}
```

### ç›‘æ§æ¥å£

#### å¥åº·æ£€æŸ¥

```http
GET /health
GET /ready
```

#### ç³»ç»ŸæŒ‡æ ‡

```http
GET /api/v1/metrics/
GET /api/v1/metrics/leaderboard/{id}
```

## ğŸ”§ é…ç½®è¯´æ˜

### ç¯å¢ƒå˜é‡

| å˜é‡å | æè¿° | é»˜è®¤å€¼ |
|--------|------|--------|
| `RANKING_SERVER_HOST` | æœåŠ¡å™¨ç›‘å¬åœ°å€ | `0.0.0.0` |
| `RANKING_SERVER_PORT` | æœåŠ¡å™¨ç«¯å£ | `8080` |
| `RANKING_MONGODB_URI` | MongoDBè¿æ¥å­—ç¬¦ä¸² | `mongodb://localhost:27017` |
| `RANKING_MONGODB_DATABASE` | MongoDBæ•°æ®åº“å | `ranking` |
| `RANKING_REDIS_ADDR` | Redisåœ°å€ | `localhost:6379` |
| `RANKING_LOG_LEVEL` | æ—¥å¿—çº§åˆ« | `info` |
| `RANKING_LOG_OUTPUT` | æ—¥å¿—è¾“å‡º | `stdout` |

### é…ç½®æ–‡ä»¶

é…ç½®æ–‡ä»¶ä½äº `configs/config.yaml`ï¼Œæ”¯æŒä»¥ä¸‹é…ç½®ï¼š

```yaml
server:
  host: "0.0.0.0"
  port: 8080
  read_timeout: 30
  write_timeout: 30

mongodb:
  uri: "mongodb://localhost:27017"
  database: "ranking"
  max_pool_size: 100

redis:
  addr: "localhost:6379"
  db: 0
  pool_size: 100

log:
  level: "info"
  format: "json"
  output: "stdout"
```

## ğŸš€ éƒ¨ç½²æŒ‡å—

### Dockeréƒ¨ç½²

```bash
# æ„å»ºé•œåƒ
make docker-build

# å¯åŠ¨æœåŠ¡
make docker-run
```

### Kuberneteséƒ¨ç½²

```bash
# åº”ç”¨Kubernetesé…ç½®
kubectl apply -f k8s/
```

### ç”Ÿäº§ç¯å¢ƒé…ç½®

1. **æ•°æ®åº“ä¼˜åŒ–**
   - MongoDBå‰¯æœ¬é›†é…ç½®
   - Redisé›†ç¾¤é…ç½®
   - æ•°æ®å¤‡ä»½ç­–ç•¥

2. **æ€§èƒ½è°ƒä¼˜**
   - è¿æ¥æ± å¤§å°è°ƒæ•´
   - ç¼“å­˜ç­–ç•¥ä¼˜åŒ–
   - ç´¢å¼•ä¼˜åŒ–

3. **ç›‘æ§å‘Šè­¦**
   - PrometheusæŒ‡æ ‡æ”¶é›†
   - Grafanaä»ªè¡¨æ¿é…ç½®
   - å‘Šè­¦è§„åˆ™è®¾ç½®

## ğŸ“Š æ€§èƒ½æŒ‡æ ‡

- **QPS**: æ”¯æŒ10,000+ QPS
- **å»¶è¿Ÿ**: P99 < 100ms
- **å¹¶å‘**: æ”¯æŒ10,000+å¹¶å‘è¿æ¥
- **å¯ç”¨æ€§**: 99.9%+

## ğŸ§ª æµ‹è¯•

### å•å…ƒæµ‹è¯•

```bash
make test
```

### æ€§èƒ½æµ‹è¯•

```bash
make load-test
```

### é›†æˆæµ‹è¯•

```bash
# å¯åŠ¨æµ‹è¯•ç¯å¢ƒ
docker-compose -f docker-compose.test.yml up -d

# è¿è¡Œé›†æˆæµ‹è¯•
go test -tags=integration ./test/...
```

## ğŸ” æ•…éšœæ’æŸ¥

### å¸¸è§é—®é¢˜

1. **è¿æ¥æ•°æ®åº“å¤±è´¥**
   ```bash
   # æ£€æŸ¥æ•°æ®åº“çŠ¶æ€
   make status
   
   # æŸ¥çœ‹æ—¥å¿—
   make logs
   ```

2. **æ’åè®¡ç®—é”™è¯¯**
   ```bash
   # é‡å»ºæ’è¡Œæ¦œç¼“å­˜
   curl -X POST http://localhost:8080/admin/leaderboard/{id}/rebuild
   ```

3. **æ€§èƒ½é—®é¢˜**
   ```bash
   # æŸ¥çœ‹ç³»ç»ŸæŒ‡æ ‡
   curl http://localhost:8080/api/v1/metrics/
   ```

### æ—¥å¿—åˆ†æ

```bash
# æŸ¥çœ‹åº”ç”¨æ—¥å¿—
make logs

# æŸ¥çœ‹é”™è¯¯æ—¥å¿—
docker-compose logs ranking-service | grep ERROR
```

## ğŸ¤ è´¡çŒ®æŒ‡å—

1. Fork é¡¹ç›®
2. åˆ›å»ºç‰¹æ€§åˆ†æ”¯ (`git checkout -b feature/AmazingFeature`)
3. æäº¤æ›´æ”¹ (`git commit -m 'Add some AmazingFeature'`)
4. æ¨é€åˆ°åˆ†æ”¯ (`git push origin feature/AmazingFeature`)
5. æ‰“å¼€ Pull Request

### ä»£ç è§„èŒƒ

- éµå¾ªGoä»£ç è§„èŒƒ
- æ·»åŠ å¿…è¦çš„æ³¨é‡Š
- ç¼–å†™å•å…ƒæµ‹è¯•
- æ›´æ–°ç›¸å…³æ–‡æ¡£

## ğŸ“„ è®¸å¯è¯

æœ¬é¡¹ç›®é‡‡ç”¨ MIT è®¸å¯è¯ - æŸ¥çœ‹ [LICENSE](LICENSE) æ–‡ä»¶äº†è§£è¯¦æƒ…ã€‚

## ğŸ‘¥ ä½œè€…

- **HHaou** - *åˆå§‹å¼€å‘* - [GitHub](https://github.com/HHaou)

## ğŸ™ è‡´è°¢

- [Gin](https://github.com/gin-gonic/gin) - HTTP Webæ¡†æ¶
- [MongoDB](https://www.mongodb.com/) - æ–‡æ¡£æ•°æ®åº“
- [Redis](https://redis.io/) - å†…å­˜æ•°æ®åº“
- [Docker](https://www.docker.com/) - å®¹å™¨åŒ–å¹³å°
- [Prometheus](https://prometheus.io/) - ç›‘æ§ç³»ç»Ÿ

## ğŸ“ æ”¯æŒ

å¦‚æœæ‚¨æœ‰ä»»ä½•é—®é¢˜æˆ–å»ºè®®ï¼Œè¯·é€šè¿‡ä»¥ä¸‹æ–¹å¼è”ç³»ï¼š

- æäº¤ [Issue](https://github.com/HHaou/ranking/issues)
- å‘é€é‚®ä»¶åˆ° [your-email@example.com]
- åŠ å…¥è®¨è®ºç¾¤ [QQç¾¤å·æˆ–å¾®ä¿¡ç¾¤]

---

**â­ å¦‚æœè¿™ä¸ªé¡¹ç›®å¯¹æ‚¨æœ‰å¸®åŠ©ï¼Œè¯·ç»™å®ƒä¸€ä¸ªæ˜Ÿæ ‡ï¼**